## License Note

The code is shared for learning purposes.
All artworks and assets are not available for reuse.


制作記録「秘密の画廊」2025/12/14 メリー
✨
'|
|

このサイトは自分の作品を飾るために制作した3dの画廊空間です。

*現在の工事状況
入口の扉と部屋を１つ実験的に配置中。
p5jsで簡易なカメラ設置。
今後、操作とUIの追加が必要なものはunityに書き換え予定。
たぶんいろんなライブラリやゲームエンジンが混ざったツギハギになります。
額縁に作品を飾っていきます。
作品追加に応じて部屋を増設。

＊制作日誌、独り言、作っているときに考えてたあれこれ
「秘密基地がほしい」というのは子供のころから大人になってもずっと無くならない憧れなんだなと年を重ねながら日々実感しています。
1人暮らしなど物理的にそういう空間でもいいけれど、ゲームをして、たとえばどうぶつの森やマインクラフトやアバターと部屋を作成するようなゲームを遊んで、精神的に自分だけの空間を持てるとその欲がだいぶ満たされるものだなと気付きました。精神的に外の世界と断絶する時間があるとなぜか落ち着きます。現実ではすぐに揃えるのが難しいものや物理的に不可能な空間を作るのは自分には本当はこんな欲があったんだなと気づいたりして驚いたりおもしろかったりします。図書館のなかに住みたいなんてことは実現するのは無理そうなことです。
わたしが子供の頃はまだインターネットの空間全体が秘密基地のようでした。今ではすっかり公共の場で繁華街の表通りです。ならば、ひっそりと静かな裏路地だってあってもいいんじゃないでしょうか。
子供のころにハウルの動く城の映画をみて原作小説を読んでとっても憧れました。いろんな場所に繋がっていて、引越しだってすぐできる。自分だけの場所。
わたしは絵と描くこととコードを書くこと、両方の制作をしています。
最近、絵を投稿する場所に悩むことが増えました。理由は最近のプラットフォームやアプリ、サービスを運営する側の技術的なことや営利性が増していることだっだり他にもいくつかあります。提供されるものより振り回されるもののほうが多くなったと感じてしまいました。うまく付き合う器用さがないので疲れてしまいました。それから自分の作品につけるタグやジャンルが適当なものがないというのも個人的な悩みです。純粋なジェネラティブアートでもなく、イラストだけだと説明不足で、でもコードは素人なのでプログラマーでもエンジニアでもありません。難しいですね。ので、じぶんで場所を作りました。ハウルのようなのらりくらり逃亡制作生活です。
ゲームが大好きでゲーム制作も夢だったのでそれも兼ねています。
部屋を増設して行って、壁に額をかけてそこに自分の作品を飾っていく。部屋の装飾もジェネラティブアート的に生成したものを使っていくのもいいかもしれません。
東京に住んではいますが展示をするのってものすごく大変です。展示に行くのは好きです。展示に出かけるとどういうものを使って工夫されているかたくさん観察して勉強させてもらっています。でも展示の大変さを思い出してはこれをするのにどれだけ労力がと思い出してしまい、とても1人でできるものではありません。作品を作る人にとって展示は憧れですが敷居とハードルはとんでもなく高いです。信用のできる場所と仲間を見つけてとても協力しあって頑張ってやっとできるようなものなのです。
なのでこのサイトはとりあえず1人でなんとかできる範囲ってどのくらいだろうって考えながら作りました。　
わたしは家の隣の川で鮎が泳ぐような田舎に生まれて育ち、わたしの慣れ親しんだ画廊とは、町の外れの古民家を改装し週末だけ東京からやってくるオーナーが美味しいご飯とコーヒーとお酒を用意して音楽家や芸術家がひっそりやってきて酒盛りや音楽会をしているようなところに紛れ込ませてもらうようなところでしたのでそういう気楽なもののほうが自分には落ち着くのです。現実で田舎で展示をしても知名度の宣伝や集客はいっさい切り捨てることになってしまいますが、ネットでは大手のプラットフォームと比べると弱いですが悩む要素にはなりません。お金と体力と額の保管場所も要りません。匿名性の保持もできます。女性には安全かもしれません。


このサイトの世界設定を説明する簡単な物語を書くとこんな感じ。
「大通りの喧騒を逃れて、一息つこうと迷い込んだ路地裏で、不思議なお店のドアを見つけた。たくさんの配管がネットワークや回路のように絡み合った狭い建物の隙間の路地の奥にひっそり隠れるようなそのドアを恐る恐るあけるとそこは画廊であった。人は誰もいない。店主も見当たらない。静かな場所だった。奥に続く暗い通路、テーブルの上にメモ書きがある。「店主離席中、ご自由にご観覧どうぞ」。奥へ進む、暗い通路、いくつかの扉、迷路のようだ、どうもおかしい、外見と内部の空間の大きさがあわない、窓の景色が全部違う、摩訶不思議である。鍵がかかった扉もある、やはり人の気配はない、冷めた紅茶のカップ、誰かここにいたようだ」
サイトの部屋は作品数に合わせてどんどん増設していく予定です。使用するライブラリもそれに1番あったものに合わせて使い分けていくつもりです。


＊ここからは実装するための技術のことです。

自分の作品を飾れるゲームっぽい操作性のある3dサイトを作るにはどうするか。

考えた条件を並べます。
・ドローコール一回。
・ライトとテクスチャ無し、頂点カラーのみ
・ローエンドスマホでもギリギリ閲覧できる。（詳しいことはよくわからないけど△5万程度にすれば動くっぽい。目安。）
・p5js、threejs、unity、ブラウザに公開できるライブラリどれにでもすぐに切り替えられる。ブラウザ以外のものにもすぐに作り直せる。
・重いと動かない、複雑だと作るのも管理も大変。3dの最小構成要素でできてる構造


これらを実現するのになんのツールをどう使えばいいか
＊3dモデル作り
・blenderでモデリング。
・ライトとテクスチャ無し。
・マテリアルは放射のみ。(ライトと法線の影響を受けず指定した色でのベタ塗りになる)
・配管は以前processingでランダムウォークを使って作ったものをdxfのカーブでインポートしてチューブ化。（これはこのお店がたくさんのネットワークや回路が絡まった中にひっそり隠れているというイメージです）
・編集モードで面の割り当て機能を使って塗り絵のように、面の一個一個に色を指定して着彩。ナイフツール超便利。
・着彩が全部終わったら、「マテリアル毎に分離する」機能を使って、同じ頂点を共有しているが面の色は違うものを切り離し一つの頂点につき一色の情報を持っている構造に整える。
・その後すべて統合。
・レンダリングエンジンをcyclesにし、ベイク機能を使って、カラー属性に追加したアクティブ頂点カラーに放射の色を焼く。（その後ソリッド表示モードのオプション設定をフラット、属性にしちゃんと焼けてるか確認する）
・plyで出力(頂点と頂点カラーしか使わないので楽、他に使いたい値があれば法線とuvのスロットが空いてるので入れることもできる)

＊コード
・threejsのPLYloaderを使ってplyの頂点と頂点カラーと面インデックスを読みとり
・p5jsのp5Geometryに上記のデータを入れる（p5jsはbeginShape（）などで作ったものは毎フレームごとに頂点バッファVBOを新しく作り続けているが、p5Geometryで作ったもの、外部から読み込んだモデルは最初の一回しかバッファを作らないので処理が速い。processingではPShapeが同じ役割。）
・読み込んだ頂点カラーの値を線型からsRGBに変換する。blenderでは色は線型の値を保持しているが画面に映る色は設定した色空間のものに全て変換して写しているらしい。（ちゃんと理解しきれてない）自分はsRGB、標準設定だったので線型をsRGBに変換する計算を追加した。p5js、processingは元から全てsRGBらしい。


いつもprocessingとp5jsで3dcgを遊んでいます。最近はシェーダーも書けるようになっていろんな色遊びができるようになりました。processingとp5jsは頂点を作り座標の値と頂点カラーをシェーダーに送って描写するとても簡単な構造です。テクスチャも使えますが私はほとんど使いません。
blenderでも、いつもprocessingでやっているのと同じ方法で色塗りをしてみようと思いました。法線もライトもテクスチャも使わず塗り絵のように面に色を選ぶだけの簡単な方法です。そうすればprocessing、p5jsの標準のシェーダーがそのまま使えますし、絵の具で色を塗る時のように自分で色を決め領域を分けるのと同じ塗り方ができます。頂点ペイント、放射マテリアルで面ごとに割り当てをする、どちらでもできると思います。両方を併用する方法もあります。でも放射マテリアルの方がいいと思います。頂点ペイントでは同じ頂点を共有している別の面に違う色を使えません。グラデーションにしたいところだけ頂点ペイントを使うのが効果的かなと思います。シェーダーノードで頂点カラー属性と放射マテリアルを両方出してシェーダーミックスで係数にアルファ値を繋げばアルファの値に合わせてどちらを優先して使うか決められます。たとえばアルファ値が大きい方の色をシェーダーに送る構造に繋げばいいのです。試してできました。でもblenderは仕様で頂点ペイントでは頂点カラーのアルファ値にアクセスできませんのでスクリプトモードで、選択しているアクティブな頂点に指定したアルファ値を入れるPythonのコードを書いてやっとできました。今後グラデーションを使いたいときこの方法も使ってみようと思います。

3dcgを構成している基本要素の最小、頂点座標、面インデックス、頂点カラーだけで作りましたのでどの3d環境でも動くと思います。3dcgを作る基礎土台の構造が全く新しいものにでも作り直されることがない限りしばらく大丈夫だと思います。ローエンドスマホでもギリギリ動くと思いますので、図書館なんかで古いスマホをWi-Fiに繋げているような子供でもドアにたどり着くことはできるでしょう。コードも全て公開になりますし、使っているツールも全部オープンソースの無料のものです。真似したい子がいるならパソコンだけ使える環境があれば誰でも真似して作れます。自分だけのお気に入りの秘密基地を誰でも好きなように作れるようになるといいですね。
どうぶつの森やマインクラフトなどのジャンルのゲームのおもしろいところはは最初は全員に全く同じデータ（ソフトウェアの部分）を渡しても、遊ぶと全部が別々の個人専用のものに変化していくというところです。ジェネラティブアートに似ています。


ところでわたしは筆で線をひき色を塗り、キーボードでコードを打って絵を描きますが、使う理由は両方好きだからどうにかして両方使っていたいからってだけです。混ざったら新しい何かが生まれるとか、思考実験だとか、哲学的な意義だとか難しいことは何も考えてません。ゲーム会社に就職する機会がなかったので自分で作っているというだけです。
しかし、コンピュータアートの歴史にそれを目的にしていたことがあったことについて考えてみます。
コードと美術が混ざるということはどういうことをいうんだろうかと少し思案してみます。技術者的な言葉と個人的な見解を使って書くと、「美術が情報そのものを作る」で「コードがシステム（仕組み）を作る」です。ではこれがどうなっていると混ざったことになるのか。1番最初にとりあえず思いつくのは取り替えっこです。「美術が情報そのものでもありシステムにもなっている」と「コードがシステムでありまた情報そのものでもある」。わたしの今回の作品の場合で考えてみます。美術の部分にあたるのは画廊空間の3dモデルとその世界観設定や物語です。システムの部分はそれを軽量にブラウザで公開する実装です。ではまずこの美術空間はシステムも持っているかどうか。画廊、個人所有、世界中から閲覧できる、すぐに引越しできる、費用がかからない、あたりがシステムと考えても良さそうです。次にコードが情報価値を持っているか。ローエンドでも動くように最軽量設計にした理由。ライトとテクスチャ使用が当たり前の現状で頂点カラーのみの手作業での着彩という手法の提示、最新スペック環境依存への批判、企業のプラットフォーム下の一方的な規約からの脱却、ジェネラティブアート的手法でオブジェクトを生成する手法が絵作りに有効なこと、またそのジェネラティブアートのアルゴリズムそのものが物語を補足する意味になっていること、コードの構成そのものがコンセプトを説明していること、オープンソースライブラリを使用しコードで作られている作品媒体があることを身近に感じてもらう、あたりが固有の情報になりそうです。でも両方の要素が両方に結びついていてキッパリとどちらかに属しているとは分けられません。たとえば頂点カラーのみにしたのは、最軽量で動かすため、絵画的に全ての色を自分で選んで領域も自分で切り分けて塗るため、processingの設計を見習い引き継ぎたいため、と美術とシステムと両方の理由を持っています。これが混ざっているということなんでしょうか。取り替えっこ以外にも混ぜ方の種類は他にもいろいろありそうです。
